---
title: Горячая перезагрузка XAML для Xamarin.Forms
description: Немедленно загружайте изменения в файл XAML для работающего приложения, чтобы не создавать Xamarin.Forms проект после каждого изменения XAML.
ms.prod: xamarin
ms.assetid: E220F054-32EE-424C-A7E5-6156BE271519
ms.technology: xamarin-forms
author: maddyleger1
ms.author: maleger
ms.date: 03/01/2021
no-loc:
- Xamarin.Forms
- Xamarin.Essentials
ms.openlocfilehash: aefd0ded8d9d0076a55f6a878761e5bb25ed69c9
ms.sourcegitcommit: 278963e21bd07fe4b0bf0ed71b32ccb53dd95eff
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "101841118"
---
# <a name="xaml-hot-reload-for-xamarinforms"></a>Горячая перезагрузка XAML для Xamarin.Forms

Горячая перезагрузка XAML подключается к существующему рабочему процессу, чтобы повысить производительность и сэкономить время. Без горячей перезагрузки XAML необходимо создавать и развертывать приложения каждый раз, когда нужно увидеть изменение XAML. При использовании горячей перезагрузки при сохранении файла XAML изменения в работающем приложении отражаются в реальном времени. Кроме того, будет поддерживаться состояние навигации и данные, что позволит быстро выполнять итерацию по пользовательскому интерфейсу без потери места в приложении. Таким образом, при горячей перезагрузке XAML вы тратите меньше времени на повторное создание и развертывание приложений для проверки изменений пользовательского интерфейса.

> [!NOTE]
> Если вы создаете собственное приложение UWP или WPF, не используя Xamarin.Forms , см. раздел [Горячая перезагрузка XAML для UWP и WPF](/visualstudio/debugger/xaml-hot-reload).

## <a name="system-requirements"></a>Требования к системе

| IDE/Framework | Минимальная требуемая версия |
|------|------------------|
|Visual Studio 2019 | 16,9 для режима "только изменения", 16,4 для режима полной страницы
Visual Studio 2019 для Mac | 8,9 для режима "только изменения", 8,4 для режима полной страницы
Xamarin.Forms | 5,0 для режима только изменений; 4,1 для режима полной страницы

## <a name="enable-xaml-hot-reload-for-xamarinforms"></a>Включить горячую перезагрузку XAML для Xamarin.Forms

Если вы начинаете с шаблона, то горячая Загрузка XAML по умолчанию включена, и проект настроен для работы без дополнительной настройки. Отлаживать приложение Android, iOS или UWP в эмуляторе или физическом устройстве и изменить код XAML, чтобы активировать горячую перезагрузку XAML.

Если вы работаете из существующего Xamarin.Forms решения, для использования горячей перезагрузки XAML не требуется дополнительная установка, но может потребоваться проверить конфигурацию, чтобы обеспечить оптимальную работу. Сначала включите его в параметрах интегрированной среды разработки:

* В Windows установите флажок **Включить горячую перезагрузку XAML** (и требуемые платформы) в меню **Сервис**  >  **Параметры**  >  **Отладка**  >  **горячей перезагрузки**.
  * В более ранних версиях Visual Studio 2019 флажок находится в **меню Сервис**  >  **Параметры**  >    >  **Горячая перезагрузка** Xamarin.
* На компьютере Mac установите флажок **Включить горячую перезагрузку Xamarin** в меню настройки **Visual Studio**  >    >  **для**  >  **горячей перезагрузки Xamarin XAML**.
  * В более ранних версиях Visual Studio для Mac флажок находится в настройках **Visual Studio**  >    >  **проекты**"  >  **горячая" перезагрузка Xamarin**.

Затем в параметрах сборки Android и iOS убедитесь, что компоновщик имеет значение "не компоновать" или "Link None". Чтобы использовать горячую перезагрузку XAML с физическим устройством iOS, необходимо также установить флажок **включить интерпретатор Mono** (visual Studio 16,4 и более поздней версии) или добавить **интерпретатор** к **дополнительным** параметрам mtouch (Visual Studio 16,3 и ниже).

Можно использовать следующую блок-схему для проверки установки существующего проекта для использования с горячей перезагрузкой XAML:

![Настройка горячей загрузки XAML](hot-reload-images/hotreloadflowchart.png "Блок-схема настройки горячей загрузки XAML")

<!-- https://aka.ms/xamarin-hot-reload-mode points to this section -->
## <a name="hot-reload-modes"></a>Режимы горячей перезагрузки

Горячая перезагрузка XAML может работать в двух разных режимах: только в более новых *режимах изменения* и в более старом *режиме полной страницы*.

Начиная с Visual Studio 16,9 и Visual Studio для Mac 8,9, по умолчанию используется режим только изменения, который используется для всех приложений, использующих Xamarin.Forms 5,0 или более поздней версии. Для более старых версий Xamarin.Forms используется режим полной страницы. Тем не менее можно принудительно использовать режим полного режима страницы для всех приложений в параметрах интегрированной среды разработки (**меню Сервис**  >  **Параметры**  >  **Отладка**  >  **горячей загрузки** в Windows или **Visual Studio**  >    >  )**для**  >  **горячей перезагрузки Xamarin XAML** на Mac.

*Режим "только изменения* " выполняет синтаксический анализ XAML, чтобы точно увидеть, что изменилось при внесении изменений, и отправляет только эти изменения в работающее приложение. Это та же технология, которая используется для горячей перезагрузки WPF и UWP. Он сохраняет состояние пользовательского интерфейса, так как не создает повторно пользовательский интерфейс для всей страницы, просто обновляя измененные свойства элементов управления, затрагиваемых изменениями. Режим "только изменения" также позволяет использовать [динамическое визуальное дерево](live-visual-tree.md).

По умолчанию с режимом "только изменения" нет необходимости сохранять файл для просмотра изменений — обновления вступают в силу немедленно, по мере ввода.
Однако это поведение можно изменить для обновления только при сохранении файла. Это можно сделать, установив флажок **Применить горячую перезагрузку XAML для сохранения документа** (в настоящее время доступно только в Windows) в параметрах интегрированной среды разработки "горячей" загрузки. Иногда может оказаться полезным только обновление в документе, если вы вносите более крупные обновления XAML и не хотите, чтобы они отображались до их завершения.

*Режим полной страницы* ОТПРАВЛЯЕТ полный XAML-файл в работающее приложение после внесения изменений и сохранения. Затем выполняющееся приложение перезагружает страницу, повторно создавая ее элементы управления — вы увидите обновление пользовательского интерфейса.

Режим "только изменения" — это будущее горячей перезагрузки, и мы рекомендуем использовать ее везде, где это возможно. Это быстрое, сохраняет состояние пользовательского интерфейса и поддерживает [динамическое визуальное дерево](live-visual-tree.md). Режим полной страницы по-прежнему предоставляется для приложений, которые еще не были обновлены до Xamarin.Forms 5,0.

> [!NOTE]
> При переключении режимов необходимо перезапустить сеанс отладки.

## <a name="xaml-errors"></a>Ошибки XAML

*Режим "только изменения*". при внесении изменений средство синтаксического анализа XAML с горячей перезагрузкой будет отображаться как неверное, оно отобразит ошибку, подчеркнутую в редакторе, и включит ее в окно ошибок. Ошибки горячей загрузки имеют код ошибки, начинающийся с "XHR" (для горячей перезагрузки XAML). Если на странице имеются такие ошибки, то при горячей загрузке не будут применяться изменения, даже если они сделаны в других частях страницы. Устраните все ошибки для горячей перезагрузки, чтобы снова начать работу со страницей.

*Режим полной страницы*: Если вы вносите изменения, которые не удается перезагрузить с помощью горячей перезагрузки XAML, отобразится ошибка, подчеркнутая в редакторе, и включите ее в окно ошибок. Эти изменения, известные как грубые изменения, содержат ошибочный ввод кода XAML или связывание элемента управления с несуществующим обработчиком событий. Даже при грубом изменении можно продолжить перезагрузку без перезапуска приложения — внести еще одно изменение в другое место в XAML-файле и нажать кнопку Сохранить. Грубое изменение не будет перезагружено, но другие изменения будут по прежнему применены.

## <a name="reload-on-multiple-platforms-at-once"></a>Повторная загрузка нескольких платформ

Горячая перезагрузка XAML поддерживает одновременную отладку в Visual Studio и Visual Studio для Mac. Вы можете одновременно развернуть устройства Android и целевой сервер iOS, чтобы увидеть изменения, отраженные на обеих платформах одновременно. Сведения об отладке на нескольких платформах см. в следующих статьях:

* **Windows** [: как задать несколько запускаемых проектов](/visualstudio/ide/how-to-set-multiple-startup-projects?view=vs-2019)
* **Mac** . [Установка нескольких запускаемых проектов](/visualstudio/mac/set-startup-projects?view=vsmac-2019)

## <a name="known-limitations"></a>Известные ограничения

* Xamarin.Forms цели, находящиеся за пределами Android, iOS и UWP (например, macOS), в настоящее время не поддерживаются.
* Использование [Ксамлкомпилатион (Ксамлкомпилатионоптионс. Skip)], отключение компиляции XAML, не поддерживается и может вызвать проблемы с динамическим визуальным деревом.
* Нельзя добавлять, удалять или переименовывать файлы или пакеты NuGet во время сеанса горячей загрузки XAML. При добавлении или удалении файла или пакета NuGet перестройте и повторно разверните приложение, чтобы продолжить использовать горячую перезагрузку XAML.
* Задайте для компоновщика значение " **не связывать** " или " **нет** " для оптимальной работы. Параметр **связать только пакет SDK** работает в большинстве случаев, но в некоторых случаях может завершиться ошибкой. Параметры компоновщика можно найти в параметрах сборки Android и iOS.
* Для отладки на физическом iPhone требуется, чтобы интерпретатор использовал горячую перезагрузку XAML. Для этого откройте параметры проекта, перейдите на вкладку сборка iOS и убедитесь, что параметр **включить интерпретатор Mono** включен. Может потребоваться изменить параметр **платформы** в верхней части страницы свойств на **iPhone**.
* Горячая перезагрузка XAML не может перезагрузить код C#, включая обработчики событий, пользовательские элементы управления, код программной части страницы и дополнительные классы.


## <a name="troubleshooting"></a>Устранение неполадок

* Чтобы просмотреть сообщения о состоянии, которые могут помочь при устранении неполадок, откройте выходные данные горячей загрузки XAML.
  * **Windows**: вывести выходные данные в **представлении**  >  **выходные данные** и выбрать **горячую перезагрузку Xamarin** в разделе **Показать выходные данные из:** в верхней части страницы.   
  * **Mac**: наведите указатель мыши на **горячую перезагрузку XAML** в строке состояния, чтобы отобразить эту панель
* Если не удается инициализировать горячую перезагрузку XAML:
  * Обновите Xamarin.Forms версию.
  * Убедитесь, что вы используете последнюю версию интегрированной среды разработки.
  * Задайте для параметров компоновщика Android или iOS значение **не связывать** в параметрах сборки проекта.
* Если при сохранении XAML-файла ничего не происходит, убедитесь, что в интегрированной среде разработки активирована Горячая перезагрузка XAML.
* Если отладка выполняется на физическом iPhone и приложение перестает отвечать, убедитесь, что интерпретатор включен. Чтобы включить его, установите флажок **включить интерпретатор Mono** (Visual Studio 16.4/8.4 и выше) или Add **--интерпретатор** в поле **Дополнительные аргументы mtouch** (Visual Studio 16.3/8.3 и более ранние версии) в параметрах сборки iOS.

Чтобы сообщить об ошибке, используйте команду **Справка**  >  **Отправить отзыв**  >  **сообщить о проблеме** в Windows и  >  **сообщить о проблеме** на компьютере Mac.

## <a name="related-links"></a>Связанные ссылки

- [Динамическое визуальное дерево](live-visual-tree.md)
- [Советы и рекомендации по горячей загрузке XAML](https://devblogs.microsoft.com/xamarin/tips-tricks-xaml-hot-reload/)
- [Полная перезагрузка XAML для подробного Xamarin.Forms изучения: Xamarin шоу](https://www.youtube.com/watch?v=crhjjPjzknk)
