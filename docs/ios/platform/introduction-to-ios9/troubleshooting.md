---
title: Xamarin. iOS 9 — Устранение неполадок
description: В этой статье приведены различные советы по устранению неполадок при работе с iOS 9 в Xamarin. iOS. Советы охватывают синтаксический анализ XML, Симуляторы, ограничения макета, сетевые проблемы и многие другие темы.
ms.prod: xamarin
ms.assetid: DCE83E36-CBD9-4D96-8E7F-384CB8A54563
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 03/20/2017
ms.openlocfilehash: 37075e485cc74b588b18503cdf8beb2307552f2f
ms.sourcegitcommit: 4bbf54d2bc1df96af69814e2e5dae47be12e0474
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102602311"
---
# <a name="xamarinios-9--troubleshooting"></a>Xamarin. iOS 9 — Устранение неполадок

_Эта статья содержит несколько советов по устранению неполадок при работе с iOS 9 в приложениях Xamarin. iOS._

## <a name="where-are-the-ios-8-simulators"></a>Где находятся симуляторы iOS 8?

Если вы установили Xcode 7 (или более позднюю версию), он автоматически заменит все симуляторы iOS 8 на симуляторы iOS 9 по умолчанию. Если вам по-прежнему требуется тестирование в iOS 8, можно запустить Xcode, а затем загрузить и установить симуляторы iOS 8.

В Xcode выберите меню **Xcode** , а затем — **настройки...**  >  **Загружаемые файлы**:

[![Загрузки для симуляторов iOS 8](troubleshooting-images/ios8.png)](troubleshooting-images/ios8.png#lightbox)

Нажмите кнопку **проверить и установить сейчас** , чтобы переустановить симуляторы iOS 8.

## <a name="layout-constraint-with-leftright-attribute-errors"></a>Ограничение макета с ошибками атрибутов Left или right

В iOS 8 (и более ранних версиях) элементы пользовательского интерфейса в раскадровках могут использовать сочетание атрибутов **правого**  &  **левого угла** ( `NSLayoutAttributeRight`  &  `NSLayoutAttributeLeft` ) и **ведущих**  &  **завершающих** атрибутов ( `NSLayoutAttributeLeading`  &  `NSLayoutAttributeTrailing` ) в одном макете.

Если в iOS 9 выполняется одна и та же раскадровка, это приведет к исключению в следующей форме:

> Завершение работы приложения из-за неперехваченного исключения "Нсинвалидаргументексцептион", причина: "* * * + [Нслайаутконстраинт Констраинтвиситем: атрибут: Релатедби: Тоитем: атрибут: множитель: константа:]: ограничение не может быть между начальным и конечным атрибутом и атрибутом правого или левого. Используйте начальные и конечные значения для обоих параметров или ни одного.

iOS 9 принудительно применяет макеты, чтобы использовать либо **правое**  &  **левое** _, либо_ **начальные**  &  **конечные** атрибуты, но *не* оба. Чтобы устранить эту проблему, измените все ограничения макета, чтобы они использовали один и тот же набор атрибутов в файле раскадровки.

Дополнительные сведения см. в описании [ошибки ограничения iOS 9](https://stackoverflow.com/questions/32692841/ios-9-constraint-error) Stack overflow обсуждении.

## <a name="error-itms-90535-unexpected-cfbundleexecutable-key"></a>Ошибка ИТМС-90535: непредвиденный ключ Кфбундликсекутабле

После перехода на iOS 9 из приложения использует сторонние компоненты (в частности, существующие компоненты Google Maps), которые были скомпилированы и запущены в iOS 8 (или более ранней версии). при попытке отправить новую сборку в iTunes Connect вы можете получить сообщение об ошибке в форме:

> Ошибка ИТМС-90535: непредвиденный ключ Кфбундликсекутабле. Пакет в "полезная нагрузка/АПП-наме. app/Component. пучок" не содержит исполняемый файл пакета...

Эта проблема обычно может быть решена путем поиска именованного пакета в проекте, а не только для сообщения об ошибке, которое можно изменить в `Info.plist` пакете, удалив `CFBundleExecutable` ключ. Необходимо `CFBundlePackageType` также задать значение для ключа `BNDL` .

После внесения этих изменений выполните очистку и перестройте весь проект. Вы можете отправить в iTunes Connect без проблем после внесения этих изменений.

Дополнительные сведения см. в этом [Stack overflow](https://stackoverflow.com/questions/32096130/unexpected-cfbundleexecutable-key) обсуждении.

## <a name="cfnetwork-sslhandshake-failed--9824-error"></a>Ошибка CFNetwork Сслхандшаке (-9824)

При попытке подключиться к Интернету либо напрямую, либо из веб-представления в iOS 9 может появиться сообщение об ошибке в форме:

```csharp
2015-09-04 14:38:05.757 FormsWebViewiOS[2553:30362] CFNetwork SSLHandshake failed (-9824)
2015-09-04 14:38:05.758 FormsWebViewiOS[2553:30363] NSURLSession/NSURLConnection HTTP load failed (kCFStreamErrorDomainSSL, -9824)
```

Или в виде:

```csharp
2015-09-04 14:39:17.881 FormsWebViewiOS[2568:30974] App Transport Security has blocked a cleartext HTTP (http://) resource load since it is insecure.
Temporary exceptions can be configured via your app's Info.plist file.
```

В iOS9 безопасность транспорта приложений (ATS) обеспечивает безопасное подключение между Интернет-ресурсами (например, серверным сервером приложения) и приложением. Кроме того, для ATS требуется обмен данными по `HTTPS` протоколу и высокоуровневое взаимодействие API для шифрования с помощью TLS версии 1,2 с пересылкой.

Поскольку ATS включена по умолчанию в приложениях, созданных для iOS 9 и OS X 10,11 (El Capitan), все соединения, использующие `NSURLConnection` , `CFURL` или, `NSURLSession` будут подвергаться требованиям безопасности ATS. Если подключения не соответствуют этим требованиям, они завершатся сбоем с исключением.

Сведения о том, как решить эту проблему, см. в разделе " [отказ от ATS](~/ios/app-fundamentals/ats.md) " руководства по [безопасности транспорта приложений](~/ios/app-fundamentals/ats.md) .

## <a name="my-existing-apps-dont-run-on-ios-9"></a>Мои существующие приложения не работают на iOS 9

Инструкции по перестроению и повторному развертыванию существующих приложений для работы в iOS 9 см. в [сведениях о совместимости с iOS 9](~/ios/platform/introduction-to-ios9/ios9.md) .

<a name="UICollectionViewCell.ContentView-is-null-in-constructors"></a>

## <a name="uicollectionviewcellcontentview-is-null-in-constructors"></a>Уиколлектионвиевцелл. ContentView имеет значение NULL в конструкторах

**Причина:** В iOS 9 `initWithFrame:` конструктор теперь является обязательным в связи с изменением поведения в iOS 9 в качестве [состояния документации уиколлектионвиев](https://developer.apple.com/library/ios/documentation/UIKit/Reference/UICollectionView_class/#//apple_ref/occ/instm/UICollectionView/dequeueReusableCellWithReuseIdentifier:forIndexPath). Если вы зарегистрировали класс для указанного идентификатора и хотите создать новую ячейку, эта ячейка инициализируется путем вызова ее `initWithFrame:` метода.

**Исправление:** Добавьте `initWithFrame:` конструктор следующим образом:

```csharp
[Export ("initWithFrame:")]
public YourCellClassName (CGRect frame) : base (frame)
{
    Initialize (); // refactor initialize code into a method
}
```

Связанные примеры: [мотионграф](https://github.com/xamarin/monotouch-samples/commit/3c1b7a4170c001e7290db9babb2b7a6dddeb8bcb), [тексткитдемо](https://github.com/xamarin/monotouch-samples/commit/23ea01b37326963b5ebf68bbcc1edd51c66a28d6)

<a name="UIView-fails-to-Init-with-Coder-when-Loading-a-View-from-a-Xib/Nib"></a>

## <a name="uiview-fails-to-init-with-coder-when-loading-a-view-from-a-xibnib"></a>UIView не удается инициализировать с помощью программиста при загрузке представления из XIB или NIB

**Причина:** `initWithCoder:` Конструктор вызывается при загрузке представления из файла Interface Builder XIB. Если этот конструктор не экспортирован, неуправляемый код не сможет вызвать управляемую версию. Ранее (например, в iOS 8) `IntPtr` конструктор был вызван для инициализации представлений.

**Исправление:** Создайте и экспортируйте `initWithCoder:` конструктор следующим образом:

```csharp
[Export ("initWithCoder:")]
public YourClassName (NSCoder coder) : base (coder)
{
    Initialize (); // refactor initialize code into a method
}
```

Связанный пример: [чат](https://github.com/xamarin/monotouch-samples/commit/7b81138d52e5f3f1aa3769fcb08f46122e9b6a88)

## <a name="dyld-message-no-cache-image-with-name"></a>Сообщение дилд: нет образа кэша с именем...

В журнале может произойти сбой со следующими данными:

```csharp
Dyld Error Message:
Dyld Message: no cach image with name (/System/Library/PrivateFrameworks/JavaScriptCore.framework/JavaScriptCore)
```

**Причина:** Это ошибка в машинном компоновщике Apple, который происходит при создании общедоступной инфраструктуры (Жаваскрипткоре был открыт в iOS 7, прежде чем он был закрытой платформой), а целевой объект развертывания приложения — для версии iOS, когда платформа была закрыта. В этом случае компоновщик Apple свяжется с закрытой версией платформы вместо общедоступной версии.

**Исправление:** Это будет решено для iOS 9, но существует простое решение, которое можно применить самостоятельно. в этом случае вы можете выбрать более позднюю версию iOS в проекте (в этом случае можно попробовать iOS 7). Другие платформы могут столкнуться с аналогичными проблемами, например, если платформа WebKit стала общедоступной в iOS 8 (и, таким образом, для iOS 7 будет возникать эта ошибка; следует выбрать iOS 8 для использования WebKit в приложении).

## <a name="untrusted-enterprise-developer"></a>Недоверенный корпоративный разработчик

При попытке запуска версии iOS 9 приложения Xamarin. iOS на реальном устройстве iOS может появиться сообщение о том, что учетная запись разработчика не является доверенной для устройства. Пример:

[![Оповещение о ненадежном корпоративном разработчике](troubleshooting-images/untrusted01.png)](troubleshooting-images/untrusted01.png#lightbox)

Чтобы решить эту проблему, выполните следующие действия.

1. Запустите Xcode (последняя бета-версия) на компьютере под управлением системы разработки Mac.
2. В меню **окно** выберите **устройства** , чтобы открыть окно устройства: 

    [![Окно "устройства"](troubleshooting-images/untrusted02.png)](troubleshooting-images/untrusted02.png#lightbox)
3. На боковой панели **устройства** выберите устройство, щелкните его правой кнопкой мыши и выберите команду **Показать профили подготовки...**: 

    [![Профили подготовки Сшов](troubleshooting-images/untrusted03.png)](troubleshooting-images/untrusted03.png#lightbox)
4. Выберите в настоящее время каждый профиль подготовки на устройстве и нажмите кнопку, **-** чтобы удалить его: 

    [![Удаление профиля подготовки](troubleshooting-images/untrusted04.png)](troubleshooting-images/untrusted04.png#lightbox)
5. В меню **Xcode** выберите **настройки...** и **учетные записи**: 

    [![Параметры учетной записи Xcode](troubleshooting-images/untrusted05.png)](troubleshooting-images/untrusted05.png#lightbox)
6. Нажмите кнопку **Просмотреть подробности...** , а затем выберите кнопку **скачать все** : 

    [![Скачать все профили](troubleshooting-images/untrusted06.png)](troubleshooting-images/untrusted06.png#lightbox)
7. После завершения обновления списка нажмите кнопку **done (Готово** ) и закройте окно настройки.
8. Удалите существующую версию приложения Xamarin. iOS, которую вы пытались протестировать с устройства iOS.
9. Вернитесь к Visual Studio для Mac, выполните чистую сборку и попробуйте повторно запустить приложение на устройстве.

Возможно, потребуется прерывать и перезапускать Visual Studio для Mac перед тем, как будут видны новые профили подготовки, загруженные Xcode. Также может потребоваться настроить параметры **подписывания пакета iOS** для приложения Xamarin. iOS, чтобы выбрать новые профили подготовки.

## <a name="launch-screen-issues"></a>Проблемы с экраном запуска

Теперь iOS 9 применяет требования к экрану запуска, чтобы один и тот же образ запуска больше не мог использоваться повторно для поддержки различных ориентаций интерфейса. Дополнительные сведения см. в [справочнике по Уиланчимаже](https://developer.apple.com/library/prerelease/ios/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW28) Apple.

При необходимости можно использовать файл раскадровки для представления экрана запуска приложения вместо использования набора **PNG** -файлов изображений. Теперь это рекомендуемый способ отображения экранов запуска в Apple. Дополнительные сведения см. [в статье Введение в унифицированные раскадровки](~/ios/user-interface/storyboards/unified-storyboards.md) .

Наконец, приложение должно использовать файл раскадровки для экрана запуска и поддерживать все четыре ориентации интерфейса (книжная, вертикально книжная, Альбомная слева и альбомная вправо), которые следует учитывать при работе на слайде на панели или в режиме разделенного представления. Чтобы узнать больше о новых возможностях многозадачности iOS 9, ознакомьтесь с руководством по [многозадачности для iPad](~/ios/platform/multitasking.md) .

## <a name="nsinternalinconsistencyexception-exception"></a>Исключение Нсинтерналинконсистенциексцептион

При компиляции и запуске существующего приложения Xamarin. iOS для iOS 9 может появиться сообщение об ошибке в форме:

> Вызвано исключение цели-C.  Имя: Нсинтерналинконсистенциексцептион причина: ожидается, что окна приложений будут иметь корневой контроллер представления в конце запуска приложения.

Эта ошибка возникает, так как ожидается, что окна приложений будут иметь корневой контроллер представления в конце запуска приложения, а существующее приложение — нет.

Существует по крайней мере два возможных способа решения этой проблемы:

1. Обновление приложения для использования файла раскадровки вместо `xib` файлов для определения пользовательского интерфейса. Для этого требуется много времени, в зависимости от размера приложения и знания того, как использовать Interface Builder Xcode для макета раскадровки. Дополнительные сведения см. в документации по [унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) .
2. Настройте `RootViewController` свойство окна приложения в `FinishedLaunching` методе в `AppDelegate` классе, чтобы указать контроллер представления в пользовательском интерфейсе приложения.

## <a name="when-to-initialize-views-and-view-controllers"></a>Когда следует инициализировать представления и контроллеры представлений

С помощью Xamarin. iOS возможно, что представления или контроллеры представлений инициализируются внутри конструкторов, которые вызываются, когда что-либо представлено в управляемом коде, но она нарушает разработку iOS.

В общем случае не следует инициализировать ничего, которое может вызывать код цели на языке C из конструктора, так как нельзя гарантировать, что он будет вызываться. Это также означает, что существует лучшее место (другой ctor) или вызовы переопределения (так как цель-C не имеет событий), где должна быть выполнена инициализация.

## <a name="related-links"></a>Связанные ссылки

- [iOS 9 для разработчиков](https://developer.apple.com/ios/pre-release/)
- [Новые возможности iOS 9,0](https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html)
- [Обновление приложений Xamarin. iOS до iOS9 (видео)](https://university.xamarin.com/lightninglectures/Updating-your-XamariniOS-apps-to-iOS9)
