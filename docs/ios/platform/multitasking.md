---
title: Многозадачность для iPad в Xamarin. iOS
description: iOS 9 поддерживает два приложения, работающих одновременно, с помощью слайдового представления или просмотра с разделением. Он также поддерживает воспроизведение видео в графическом виде.
ms.prod: xamarin
ms.assetid: 0F2266D7-21FF-404D-A148-0CFDE76B12AA
ms.technology: xamarin-ios
ms.custom: xamu-video
author: davidortinau
ms.author: daortin
ms.date: 03/20/2017
ms.openlocfilehash: 76ce375e611ddc8ee21d76e7947601319bf9dba8
ms.sourcegitcommit: e27e29c14b783263e063baaa65d4eecb8dd31f57
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98628947"
---
# <a name="multitasking-for-ipad-in-xamarinios"></a>Многозадачность для iPad в Xamarin. iOS

_iOS 9 поддерживает два приложения, работающих одновременно, с помощью слайдового представления или просмотра с разделением. Он также поддерживает воспроизведение видео в графическом виде._

![Пример разделения экрана](multitasking-images/about02-sml.png) ![Пример рисунка на рисунке](multitasking-images/about03-sml.png)

iOS 9 добавляет поддержку многозадачности для одновременного выполнения двух приложений на конкретном оборудовании iPad. Многозадачность для iPad поддерживается с помощью следующих функций:

- [**Скольжение**](#Slide-Over) : позволяет пользователю временно запустить второе приложение iOS на панели слайдов (в правой или левой части экрана в зависимости от направления языка), которое охватывает примерно 25% основного приложения, запущенного в данный момент. Ползунок доступен только в iPad Pro, iPad Air, iPad AIR 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4.
- [**Представление с разделением**](#Split-View) — на поддерживаемом оборудовании iPad (только iPad AIR 2, iPad Mini 4 и iPad Pro) пользователь может выбрать второе приложение и запустить его параллельно с выполняющимся в данный момент приложением в режиме разделения экрана. Пользователь может контролировать процент главного экрана, занимаемого каждым приложением.
- [**Рисунок**](#Picture-in-Picture) . для приложений, воспроизводящих видеоматериалы, видео теперь можно воспроизводить в окне перемещаемого и изменяемого размера, которое перемещается на другие приложения, выполняющиеся на устройстве iOS. Пользователь имеет полный контроль над размером и положением этого окна. Рисунок на рисунке доступен только в iPad Pro, iPad Air, iPad AIR 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4.

При [поддержке многозадачности в приложении](#Supporting-Multitasking-in-your-App)необходимо учитывать ряд моментов, в том числе:

- [Размер и ориентация экрана](#Screen-Size-Considerations)
- [Настраиваемые аппаратные сочетания клавиш](#Custom-Hardware-Keyboard-Shortcuts)
- [Управление ресурсами](#Resource-Management-Considerations)

Разработчик приложения также может [отказаться от многозадачности](#Opting-Out-of-Multitasking), включая [отключение воспроизведения видео PIP](#Disabling-PIP-Video-Playback).

В этой статье рассматриваются шаги, необходимые для того, чтобы приложение Xamarin. iOS правильно выполнялось в многозадачной среде или отказаться от многозадачности, если оно не подходит для вашего приложения.

> [!VIDEO https://youtube.com/embed/GctYAozoLr8]

**Поддержка многозадачности для iPad видео**

<a name="Multitasking-QuickStart"></a>

## <a name="multitasking-quickstart"></a>Быстрый запуск многозадачной работы

Для поддержки просмотра **слайдов** в приложении или с **разделением** приложение должно выполнить следующие действия.

- Быть создан для iOS 9 (или более поздней версии).
- Используйте раскадровку для экрана запуска (а не ресурсов изображения).
- Используйте раскадровку с классами автомакета и размера для пользовательского интерфейса.
- Поддержка всех 4 ориентаций устройств iOS (книжная, сверху вниз книжная, Альбомная слева & альбомная справа).

<a name="Multitasking"></a>

## <a name="about-multitasking-for-ipad"></a>Сведения о многозадачности для iPad

iOS 9 предлагает новые возможности многозадачности на iPad, в которых отображаются _Слайды_ с _разделением_ (iPad AIR 2, iPad Mini 4 и iPad Pro) и _на рисунке_. В следующих разделах мы рассмотрим эти функции более подробно.

<a name="Slide-Over"></a>

### <a name="slide-over"></a>Продвигаться по

Функция «скольжение за пределами» позволяет пользователю выбрать второе приложение и отобразить его на небольшой скользящей панели, чтобы обеспечить быстрое взаимодействие. Панель «скольжение за преработкой» является временной и закрывается, когда пользователь снова переходит к работе с основным приложением.

[![Ползунок на панели](multitasking-images/about01.png)](multitasking-images/about01.png#lightbox)

Следует помнить, что пользователь решает, какие два приложения будут выполняться параллельно и что разработчик не контролирует этот процесс. В результате необходимо выполнить несколько действий, чтобы убедиться, что приложение Xamarin. iOS правильно работает на панели.

- **Используйте классы автомакета и размерности** . так как приложение Xamarin. IOS теперь можно запустить на боковой панели «скольжение», вы больше не сможете полагаться на устройство, его размер экрана или ориентацию для макета пользовательского интерфейса. Чтобы обеспечить правильное масштабирование приложения в интерфейсе, необходимо использовать классы автомакета и размера. Дополнительные сведения см. в документации по [унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) .
- **Эффективное использование ресурсов** — так как приложение теперь может совместно использовать систему с другим работающим приложением, очень важно, чтобы приложение эффективно использовало системные ресурсы. Когда память становится разреженной, система автоматически завершит работу приложения, которое потребляет наибольшее объем памяти. Дополнительные сведения см. в статье [по эффективному использованию энергии Apple для приложений iOS](https://developer.apple.com/library/prerelease/ios/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243) .

Ползунок доступен только в iPad Pro, iPad Air, iPad AIR 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4. Дополнительные сведения о подготовке приложения для показа слайдов см. в документации по [iPad](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/index.html#//apple_ref/doc/uid/TP40015145) .

<a name="Split-View"></a>

### <a name="split-view"></a>Представление с разделением

На поддерживаемом оборудовании iPad (только для iPad AIR 2, iPad Mini 4 и iPad Pro) пользователь может выбрать второе приложение и запустить его параллельно с работающим в данный момент приложением в режиме разделения экрана. Пользователь может контролировать процент главного экрана, занимаемого каждым приложением, перетаскивая разделитель на экране.

[![Представление с разделением](multitasking-images/about02.png)](multitasking-images/about02.png#lightbox)

Как и в случае со слайдом, пользователь решает, какие два приложения будут выполняться параллельно и опять, разработчик не контролирует этот процесс. В результате разделение представления помещает аналогичные требования в приложение Xamarin. iOS:

- **Используйте классы автомакета и размерности** . так как ваше приложение Xamarin. IOS теперь можно запускать в режиме расщепления экрана в заданном пользователем размере, вы больше не сможете полагаться на устройство, его размер или ориентацию для макета пользовательского интерфейса. Чтобы обеспечить правильное масштабирование приложения в интерфейсе, необходимо использовать классы автомакета и размера. Дополнительные сведения см. в документации по [унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) .
- **Эффективное использование ресурсов** — так как приложение теперь может совместно использовать систему с другим работающим приложением, очень важно, чтобы приложение эффективно использовало системные ресурсы. Когда память становится разреженной, система автоматически завершит работу приложения, которое потребляет наибольшее объем памяти. Дополнительные сведения см. в статье [по эффективному использованию энергии Apple для приложений iOS](https://developer.apple.com/library/prerelease/ios/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243) .

Дополнительные сведения о подготовке приложения к разделенному представлению см. в документации по [iPad](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/index.html#//apple_ref/doc/uid/TP40015145) .

<a name="Picture-in-Picture"></a>

### <a name="picture-in-picture"></a>Изображение на рисунке

Новая функция «рисунок в рисунке» (также известная как _PIP_) позволяет пользователю просматривать видео в маленьком, плавающем окне, которое пользователь может разместить в любом месте экрана над другими работающими приложениями.

[![Пример изображения в плавающем окне с изображением](multitasking-images/about03.png)](multitasking-images/about03.png#lightbox)

Как и в режиме «скольжение за предельным представлением», пользователь имеет полный контроль над просмотром видео в графическом режиме. Если функция Main приложения предназначена для просмотра видео, для правильной работы в режиме PIP потребуется внести изменения. В противном случае для поддержки PIP не требуется никаких изменений.

Чтобы приложение отображало видео PIP по запросу пользователя, необходимо использовать _авкит_ или _API-интерфейсы AV Foundation_. Среда проигрывателя мультимедиа была амортизировано в iOS 9 и не поддерживает PIP.

Рисунок на рисунке доступен только в iPad Pro, iPad Air, iPad AIR 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4. Дополнительные сведения см. в [Пиктуреинпиктуре примере приложения](/samples/browse/?products=xamarin&term=Xamarin.iOS%2biOS9) и [на рисунке Apple в](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForPictureInPicture.html#//apple_ref/doc/uid/TP40015145-CH14) документации по быстрое начало.

<a name="Supporting-Multitasking-in-your-App"></a>

## <a name="supporting-multitasking-in-your-app"></a>Поддержка многозадачности в приложении

Для любого существующего приложения Xamarin. iOS поддержка многозадачности является прозрачной задачей, если приложение уже соответствует руководствам по проектированию Apple и рекомендациям для iOS 8. Это означает, что приложение должно использовать раскадровки с классами Автомакет и размер для макетов пользовательского интерфейса (Дополнительные сведения см. [в статье Введение в унифицированные раскадровки](~/ios/user-interface/storyboards/unified-storyboards.md) ).

Для этих приложений не требуется вносить изменения, чтобы поддерживать многозадачность и вести себя в ней. Если пользовательский интерфейс приложения создан с помощью других методов, таких как прямое позиционирование и изменение размеров элементов пользовательского интерфейса в коде C#, или если он зависит от размеров или ориентации экрана устройства, для правильной поддержки многозадачности iOS 9 потребуется значительное изменение.

Для поддержки многозадачности iOS 9 в любом новом приложении Xamarin. iOS снова используйте раскадровки с классами Автомакет и размер для всех макетов пользовательского интерфейса приложения и реализуйте инструкции в следующих разделах.

<a name="Screen-Size-Considerations"></a>

### <a name="screen-size-and-orientation-considerations"></a>Рекомендации по размеру и ориентации экрана

До iOS 9 вы можете разрабатывать приложения на основе размеров и ориентации экрана конкретного устройства. Поскольку приложение теперь можно запускать на панели слайдов или в режиме разделенного представления, оно может найти себя в компактном или обычном классе размера на iPad, независимо от физической ориентации или размера экрана устройства.

[![Рекомендации по размеру и ориентации экрана](multitasking-images/sizeclasses01.png)](multitasking-images/sizeclasses01.png#lightbox)

На iPad приложение с полноэкранным режимом имеет стандартные классы горизонтального и вертикального размера. Все устройства iPhone, кроме iPhone 6 Plus и iPhone 6S Plus, имеют компактные классы размера в обоих направлениях в любой ориентации. IPhone 6 Plus и iPhone 6S Plus в альбомном режиме имеют обычный горизонтальный размер и класс вертикального размера (подобно мини-приложению iPad).

В iPad, поддерживающем представление "скольжение и разделение", можно получить следующие сочетания:

| **Orientation** | **Основное приложение** | **Дополнительное приложение** |
|--- |--- |--- |
| **Книжная** |75% экрана<br />Горизонтальное сжатие<br />Обычный вертикальный|25% экрана<br />Горизонтальное сжатие<br />Обычный вертикальный|
| **Альбомная** |75% экрана<br />Обычная по горизонтали<br />Обычный вертикальный|25% экрана<br />Горизонтальное сжатие<br />Обычный вертикальный|
| **Альбомная** |50% экрана<br />Горизонтальное сжатие<br />Обычный вертикальный|50% экрана<br />Горизонтальное сжатие<br />Обычный вертикальный|

В примере приложения [мулитаск](/samples/xamarin/ios-samples/ios9-multitask) , если оно выполняется во весь экран на iPad в альбомном режиме, в нем одновременно будет представлен список и подробное представление:

[![Список и подробное представление, представленные в одно и то же время](multitasking-images/sizeclasses03.png)](multitasking-images/sizeclasses03.png#lightbox)

Если одно и то же приложение выполняется на панели, оно размещается как класс горизонтального размера в компактном виде и отображает только список:

[![Только список, представленный при горизонтальном устройстве](multitasking-images/sizeclasses04.png)](multitasking-images/sizeclasses04.png#lightbox)

Чтобы обеспечить правильную работу приложения в таких ситуациях, следует использовать коллекции признаков вместе с классами размера и соответствовать `IUIContentContainer` `IUITraitEnvironment` интерфейсам и. Дополнительные сведения см. в [справочнике по классу Уитраитколлектион](https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UITraitCollection_ClassReference/index.html#//apple_ref/doc/uid/TP40014202) Apple и [в статье Введение в унифицированные раскадровки](~/ios/user-interface/storyboards/unified-storyboards.md) .

Кроме того, вы больше не можете полагаться на границы экрана устройств, чтобы определить видимую область приложения. вместо этого необходимо использовать границы окна приложения. Поскольку границы окон полностью находятся под контролем пользователя, нельзя программно настраивать их или запрещать пользователю изменять эти границы.

Наконец, приложение должно использовать файл раскадровки для представления экрана запуска вместо использования набора **PNG** -файлов изображений и поддержки всех четырех ориентаций интерфейсов (книжная, вертикальная книжная, Альбомная слева и альбомная вправо), которые следует учитывать при работе на слайде на панели или в режиме разделенного представления.

<a name="Custom-Hardware-Keyboard-Shortcuts"></a>

### <a name="custom-hardware-keyboard-shortcuts"></a>Настраиваемые аппаратные сочетания клавиш

В iOS 9, работающем на iPad, компания Apple обеспечивает расширенную поддержку аппаратных клавиатур. iPad всегда включала базовую поддержку внешней клавиатуры через Bluetooth, а некоторые производители клавиатуры создали клавиатуру, включающую жесткие проводные ключи iOS.

Теперь с iOS 9 приложения могут создавать собственные сочетания клавиш. Кроме того, доступны некоторые основные сочетания клавиш, такие как **Command-C** (копирование), **Command-X** (вырезать), **Command-V** (вставка) и **Command-Shift-H** (Главная), без специального письменного ответа.

На **вкладке команд** отображается переключатель приложений, позволяющий пользователю быстро переключаться между приложениями с клавиатуры, подобно Mac OS:

[![Переключатель приложений](multitasking-images/keyboard01.png)](multitasking-images/keyboard01.png#lightbox)

Если приложение iOS 9 содержит сочетания клавиш, пользователь может удерживать **команды**, **Параметры** или клавиши **управления** для их показа во всплывающем окне:

[![На снимке экрана показаны сочетания клавиш для приложения.](multitasking-images/keyboard02.png)](multitasking-images/keyboard02.png#lightbox)

#### <a name="defining-custom-keyboard-shortcuts"></a>Определение пользовательских сочетаний клавиш

Если добавить следующий код в представление или контроллер представления в приложении, когда это представление или контроллер отображается, будет доступно пользовательское сочетание клавиш:

```csharp
#region Custom Keyboard Shortcut
public override bool CanBecomeFirstResponder {
    get { return true; }
}

public override UIKeyCommand[] KeyCommands {
    get {

        var keyCommand = UIKeyCommand.Create (new NSString("n"), UIKeyModifierFlags.Command, new Selector ("NewEntry"), new NSString("New Entry"));
        return new UIKeyCommand[]{ keyCommand };
    }
}

[Export("NewEntry")]
public void NewEntry() {

    // Add a new entry
    ...

}
#endregion
```

Сначала мы переопределяем `CanBecomeFirstResponder` свойство и возвращаем, `true` чтобы представление или контроллер представления могли получать ввод с клавиатуры. 

Далее мы переопределяем `KeyCommands` свойство и создадим новое `UIKeyCommand` для нажатия клавиши **Command-N** . При активации нажатия клавиши вызывается `NewEntry` метод (который мы предоставляем в iOS 9 с помощью `Export` команды) для выполнения запрошенного действия.

Если запустить это приложение на устройстве iPad с подключенной аппаратной клавиатурой, а пользователь вводит **команду-N**, в список будет добавлена новая запись. Если пользователь удерживает клавишу **Command** , появится список ярлыков:

[![На снимке экрана показан новый ярлык для приложения.](multitasking-images/keyboard03.png)](multitasking-images/keyboard03.png#lightbox)

Пример реализации см. в примере [приложения для многозадачности](/samples/xamarin/ios-samples/ios9-multitask) .

<a name="Resource-Management-Considerations"></a>

### <a name="resource-management-considerations"></a>Рекомендации по управлению ресурсами

Даже для приложений, которые уже используют руководства по проектированию iOS 8 и лучшие методики, эффективное управление ресурсами может по-прежнему быть проблемой. В iOS 9 приложения больше не имеют монопольного использования памяти, ЦП или других системных ресурсов.

В результате необходимо точно настроить приложение Xamarin. iOS, чтобы эффективно использовать системные ресурсы или завершать работу в ситуациях нехватки памяти. Это справедливо и для приложений, относящихся к многозадачности, так как второе приложение по-прежнему может выполняться на слайде через панель или изображение в окне изображения, которое требует дополнительных ресурсов, или вызывая частоту обновления ниже 60 кадров в секунду.

Рассмотрим следующие действия пользователя и их последствия:

- **Ввод текста на слайде через панель** . даже если в приложении нет текстового ввода, системная клавиатура теперь может отображаться в пользовательском интерфейсе. В результате приложение может потребовать ответа на уведомления экрана клавиатуры (например, отображение и скрытие клавиатуры).
- **Запуск второго приложения на слайде поверх панели** . Теперь новое приложение выполняется на переднем плане и конкурирующим образом с существующим приложением для системных ресурсов, таких как память и циклы ЦП.
- **Воспроизведение видео в окне PIP** — не только это окно охватывает часть интерфейса приложения, но приложение, которое запустило видео, по-прежнему выполняется в фоновом режиме и ПОТРЕБЛЯЕТ ресурсы ЦП и памяти.

Чтобы обеспечить эффективное использование ресурсов приложением, необходимо выполнить следующие действия.

- **Профилирование приложения с помощью инструментов** — проверка утечек памяти, ЗАМЕТНЫ использования ЦП и областей, в которых приложение может блокировать основной поток.
- **Реагирование на методы перехода состояния** — в переопределении файла **AppDelegate.CS** и ответ на такие методы изменения состояния, как приложение, которое вводит или возвращает из фона. Освободите все ненужные ресурсы, такие как изображения, данные, представления и контроллеры представлений.
- **Тестирование параллельно с ресурсоемкими приложениями** . Запустите приложение, используя как слайды, так и разделенное представление на физическом оборудовании iOS с помощью приложения, интенсивно использующего память, такого как карты (в режиме спутникового просмотра), и протестируйте, что оба приложения остаются на скорости и не завершаются сбоем.

Дополнительные сведения об управлении ресурсами см. в статье [руководство по эффективному энергосбережению Apple для приложений iOS](https://developer.apple.com/library/prerelease/ios/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243) .

<a name="Opting-Out-of-Multitasking"></a>

## <a name="opting-out-of-multitasking"></a>Отказ от многозадачности

Хотя компания Apple предлагает, что все приложения iOS 9 поддерживают многозадачность, для приложения могут быть необходимы определенные причины, например игры или приложения камеры, требующие правильной работы полноэкранного режима.

Чтобы отключить запуск приложения Xamarin. iOS либо на панели слайдов, либо в режиме разделенного просмотра, измените файл **info. plist** проекта и установите флажок **требуется полный экран**:

[![Отказ от многозадачности](multitasking-images/fullscreen01.png)](multitasking-images/fullscreen01.png#lightbox)

> [!IMPORTANT]
> Несмотря на то, что при отключении многозадачной работы приложение не будет запускаться в режиме показа слайдов или в представлении с разделением, оно не помешает запустить другое приложение на слайде или изображение в графическом видео, отображаемое вместе с приложением.

<a name="Disabling-PIP-Video-Playback"></a>

### <a name="disabling-pip-video-playback"></a>Отключение воспроизведения видео PIP

В большинстве случаев приложение должно разрешать пользователю воспроизводить содержимое видео, которое отображается на изображении в плавающем окне. Однако могут возникнуть ситуации, в которых это может оказаться нежелательным, например, при вырезание видео из сцены.

Чтобы отказаться от воспроизведения видео PIP, выполните следующие действия в приложении:

- Если вы используете `AVPlayerViewController` для показа видео, присвойте `AllowsPictureInPicturePlayback` свойству значение `false` .
- Если вы используете `AVPlayerLayer` для показа видео, не создавайте экземпляр `AVPictureInPictureController` .
- Если вы используете `WKWebView` для показа видео, присвойте `AllowsPictureInPictureMediaPlayback` свойству значение `false` .

<a name="Summary"></a>

## <a name="summary"></a>Сводка

В этой статье описаны действия, которые необходимо выполнить, чтобы убедиться, что приложение Xamarin. iOS будет запущено и правильно работать в новой многозадачной возможности iOS 9 для iPad. Кроме того, он охватывает не все задачи для приложений, где это не подходит.

## <a name="related-links"></a>Связанные ссылки

- [Примеры для iOS 9](/samples/browse/?products=xamarin&term=Xamarin.iOS%2biOS9)
- [Многозадачная (пример)](/samples/xamarin/ios-samples/ios9-multitask)
- [Введение в унифицированные раскадровки](~/ios/user-interface/storyboards/unified-storyboards.md)
- [iOS 9 для разработчиков](https://developer.apple.com/ios/pre-release/)
- [iOS 9,0](https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html)
- [Внедрение усовершенствований многозадачности на iPad](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/index.html#//apple_ref/doc/uid/TP40015145)
- [Запись блога](https://blog.xamarin.com/using-auto-layouts-for-ios-9-splitview/)