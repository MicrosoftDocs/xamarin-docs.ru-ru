---
title: Публикация приложений Xamarin.iOS в App Store
description: Этот документ описывает, как выполнять настройку, сборку и публикацию приложения Xamarin.iOS для распространения через App Store.
ms.prod: xamarin
ms.assetid: DFBCC0BA-D233-4DC4-8545-AFBD3768C3B9
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 06/25/2018
ms.openlocfilehash: af5678c5ed6fe5376588f39d9f878d03c7de9f9f
ms.sourcegitcommit: e27e29c14b783263e063baaa65d4eecb8dd31f57
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/21/2021
ms.locfileid: "98628999"
---
# <a name="publishing-xamarinios-apps-to-the-app-store"></a>Публикация приложений Xamarin.iOS в App Store

Чтобы опубликовать приложение в [App Store](https://www.apple.com/ios/app-store/), разработчик должен сначала отправить его на проверку компании Apple вместе со снимками экранов, описанием, значками и другими сведениями. После утверждения приложения Apple поместит его в App Store, где пользователи смогут приобрести его и установить непосредственно со своих устройств iOS.

В этом руководстве приведены действия по подготовке приложения к публикации в App Store и отправке его на проверку в компанию Apple. В частности, здесь описано следующее:

> [!div class="checklist"]
>
> - Выполнение правил проверки приложений в App Store
> - Настройка идентификатора и назначений приложения
> - Настройка значка App Store и значков приложений
> - Настройка профиля подготовки App Store
> - Обновление конфигурации сборки "**Выпуск**"
> - Настройка приложения в iTunes Connect
> - Сборка приложения и отправка его в Apple

> [!IMPORTANT]
> Корпорация Apple [объявила](https://developer.apple.com/ios/submit/), что начиная с марта 2019 г. все публикуемые в App Store приложения и обновления должны быть собраны с использованием пакета SDK для iOS 12.1 или более поздних версий, входящего в Xcode версии 10.1 и выше.
> Кроме того, приложения должны поддерживать размеры экранов iPhone XS и iPad Pro с диагональю 12,9 дюйма.

## <a name="app-store-guidelines"></a>Правила App Store

Перед отправкой приложения на публикацию в App Store убедитесь, что оно соответствует стандартам, указанным в [Правилах проверки приложений App Store](https://developer.apple.com/appstore/resources/approval/guidelines.html) компании Apple.
Apple проверяет публикуемые в App Store приложения на соответствие этим требованиям. При несоответствии Apple отклоняет приложение. В этом случае вам следует устранить указанные несоответствия и отправить его заново.
Таким образом, рекомендуется ознакомиться с правилами на ранних этапах процесса разработки.

Прежде чем отправлять приложение, проверьте следующие моменты:

1. Убедитесь, что описание приложения соответствует его функциональным возможностям.
2. Протестируйте приложение на отсутствие сбоев при обычном использовании. Приложение нужно проверить на всех устройствах с iOS, которые оно поддерживает.

Кроме того, ознакомьтесь с [ресурсами по App Store](https://developer.apple.com/app-store/resources/), предлагаемыми компанией Apple.

## <a name="set-up-an-app-id-and-entitlements"></a>Настройка идентификатора и назначений приложения

Каждое iOS-приложение имеет уникальный идентификатор со связанным набором служб приложений, называемых *назначениями*. Назначения позволяют приложению выполнять различные действия, например получать push-уведомления, обращаться к функциям iOS, таким как HealthKit, и многое другое.

Чтобы создать идентификатор приложения и выбрать необходимые назначения, зайдите на [портал для разработчиков Apple](https://developer.apple.com/account/) и выполните следующие действия:

1. Войдите на [портал для разработчиков Apple](https://developer.apple.com/account/). Если у вас еще нет идентификатора Apple ID, [создайте его](https://appleid.apple.com/account?appId=632&returnUrl=https%3A%2F%2Fdeveloper.apple.com%2Faccount%2F#!&page=create).
2. Выберите **"Сертификаты", "Идентификаторы и профили"** , а затем перейдите в раздел **Идентификаторы**.
3. Нажмите кнопку **+** рядом с заголовком "Идентификаторы" в верхней части страницы.
4. Выберите **Идентификаторы приложений** и щелкните **Продолжить**. 
5. Выберите **Приложения**, а затем нажмите кнопку **Продолжить**.
6. Для нового приложения введите значения в поля **Описание** и **Идентификатор пакета** и выберите значения в поле **Возможности**, которые потребуются для приложения Xamarin.iOS. Более подробно службы приложений описаны в руководстве [Работа с возможностями в Xamarin.iOS](~/ios/deploy-test/provisioning/capabilities/index.md). Завершив настройку параметров, нажмите кнопку **Продолжить**.
7. Нажмите кнопку **Зарегистрировать**, чтобы закончить процесс создания идентификатора приложения.

Помимо выбора и настройки требуемых служб приложений при задании ИД приложения необходимо также настроить ИД и назначения приложения в проекте Xamarin.iOS, отредактировав файлы **Info.plist** и **Entitlements.plist**. Дополнительные сведения см. в руководстве [Работа с разрешениями в Xamarin.iOS](~/ios/deploy-test/provisioning/entitlements.md), где описано, как создать файл **Entitlements.plist** и какие параметры назначений он содержит.

## <a name="include-an-app-store-icon"></a>Добавление значка App Store

При отправке приложения в Apple убедитесь, что оно включает каталог ресурсов, содержащий значок App Store. Соответствующие инструкции см. в руководстве по [значкам App Store в Xamarin.iOS](~/ios/app-fundamentals/images-icons/app-store-icon.md).

## <a name="set-the-apps-icons-and-launch-screens"></a>Настройка значков приложений и экранов запуска

Чтобы Apple опубликовала приложение в App Store, оно должно содержать требуемые значки и экраны запуска для всех поддерживаемых им iOS-устройств. Дополнительные сведения о настройке значков приложений и экранов запуска см. в следующих руководствах:

- [Значки приложений в Xamarin.iOS](~/ios/app-fundamentals/images-icons/app-icons.md)
- [Экраны запуска для приложений Xamarin.iOS](~/ios/app-fundamentals/images-icons/launch-screens.md)

## <a name="create-and-install-an-app-store-provisioning-profile"></a>Создание и установка профиля подготовки App Store

Для управления развертыванием определенных сборок приложений в iOS используются *профили подготовки*. Эти файлы содержат информацию о сертификате, используемом для подписывания приложения, идентификатор приложения, а также о том, где можно устанавливать приложение. Для разработки и установки на определенные устройства профиль подготовки также включает список разрешенных устройств, где можно развертывать приложение. Однако для публичного распространения через App Store в приложение включаются только сертификат и идентификатор, поскольку другие механизмы установки не используются.

Чтобы создать и установить профиль подготовки App Store, выполните следующие действия:

1. Войдите на [портал для разработчиков Apple](https://developer.apple.com/account/).
2. Выберите **"Сертификаты", "Идентификаторы и профили"** , а затем перейдите в раздел **Профили**.
3. Нажмите кнопку **+** , выберите **Разработка приложений iOS** и **App Store** и щелкните **Продолжить**.
4. Выберите свой **ИД приложения** в списке, а затем щелкните **Продолжить**.
5. Выберите сертификат для подписи и вновь щелкните **Продолжить**.
6. Выберите устройства для включения в этот профиль и щелкните **Продолжить**.
7. Введите значение в поле **Имя профиля подготовки** и щелкните **Создать**, чтобы создать профиль.
8. Воспользуйтесь инструментами Xamarin по [управлению учетными записями Apple](~/cross-platform/macios/apple-account-management.md) и скачайте только что созданный профиль подготовки на свой Mac. Если вы работаете на Mac, вы также можете скачать профиль подготовки непосредственно с портала для разработчиков Apple и запустить его установку двойным щелчком.

Подробные инструкции см. в разделах [Создание профиля распространения](~/ios/get-started/installation/device-provisioning/manual-provisioning.md#provisioningprofile) и [Выбор профиля распространения в проекте Xamarin.iOS](~/ios/deploy-test/app-distribution/app-store-distribution/index.md#selectprofile).

## <a name="update-the-release-build-configuration"></a>Обновление конфигурации сборки "Выпуск"

В новых проектах Xamarin.iOS автоматически создаются _конфигурации сборки_ **Отладка** и **Выпуск**. Для корректной настройки сборки **Выпуск** выполните следующие действия:

# <a name="visual-studio-for-mac"></a>[Visual Studio для Mac](#tab/macos)

1. На **Панели решения** откройте файл **Info.plist**, расположенный в проекте iOS. 
2. Вы должны находиться в представлении **Приложение**. Его можно задать, щелкнув параметр на нижней панели навигации.
3. В качестве варианта подписывания выберите **Подготовка вручную**. Сохраните файл и закройте его.
4. Щелкните правой кнопкой мыши **имя проекта** на **Панели решения**, выберите **Параметры** и перейдите на вкладку **Сборка iOS**.
5. Для элемента **Конфигурация** задайте значение **Выпуск**, а для элемента **Платформа** — **iPhone**.
6. Чтобы выполнить сборку с конкретным пакетом SDK для iOS, выберите его в списке **Версия SDK**. В противном случае оставьте значение **по умолчанию**.
7. Компоновка уменьшает общий размер приложения за счет исключения неиспользуемого кода.
   * В большинстве случаев для **Поведения компоновщика** рекомендуется оставить значение по умолчанию: **Компоновать только пакеты SDK платформы**.
   * Использование параметра **Не компоновать** может привести к тому, что Apple отклонит приложение из-за наличия необщедоступных API iOS в Xamarin.iOS, которые будут связаны с параметром **Компоновать только пакеты SDK платформы**.
   * Параметр **Компоновать все** следует использовать с осторожностью, так как он удалит код из всех сборок проекта, включая сторонние библиотеки. Он может удалить код, который библиотека стороннего производителя может использовать только через отражение, недоступное для обнаружения компоновщику, так как он выполняет статический анализ кода для определения используемого кода библиотеки. Используйте параметр **Компоновать все** с осторожностью, так как может потребоваться вручную сохранить некоторые классы или методы, чтобы избежать сбоев во время выполнения из-за отсутствия кода.
   * Дополнительные сведения см. в руководстве [Компоновка приложений Xamarin.iOS](~/ios/deploy-test/linker.md).
8. Для устройств с iOS 11 необходимо выбрать одну из архитектур, поддерживающих **ARM64**. Дополнительные сведения о сборке для 64-разрядных устройств с iOS см. в разделе по **активации 64-разрядных сборок приложений Xamarin.iOS** в документации [Особенности 32- и 64-разрядных платформ](~/cross-platform/macios/32-and-64/index.md).
9. При необходимости вы можете использовать компилятор **LLVM** для создания более быстрого и компактного кода. Однако в этом случае увеличивается время компиляции.
10. Чтобы еще сильнее уменьшить размер приложения, установите флажок **Оптимизировать изображения PNG**.
11. Включать отладку _не следует_, так как это приведет к неоправданному увеличению размера сборки.
12. Исходя из потребностей вашего приложения, вы также можете настроить тип **сборки мусора** и конфигурацию **интернационализации**.
    
    После настройки параметров, как описано выше, параметры сборки должны выглядеть примерно следующим образом.

    ![Параметры сборки iOS](publishing-to-the-app-store-images/build-m157.png "Параметры сборки iOS")

    Дополнительные сведения о параметрах сборки см. в руководстве [Механизм сборки iOS](~/ios/deploy-test/ios-build-mechanics.md).

13. Откройте вкладку **Подписывание пакета iOS**. Если приведенные здесь параметры недоступны для изменения, задайте параметр **Подготовка вручную** в файле **Info.plist**.
14. Для элемента **Конфигурация** выберите значение **Выпуск**, а для элемента **Платформа** — **iPhone**.
15. В качестве значения **Удостоверение подписывания** выберите **Распределение (автоматически)**.
16. В качестве **Профиля подготовки** выберите профиль подготовки App Store, [созданный выше](#create-and-install-an-app-store-provisioning-profile).

    Параметры подписывания для пакета проекта теперь должны выглядеть примерно так:

    ![Подписывание пакета iOS](publishing-to-the-app-store-images/bundleSigning-m157.png "Подписывание пакета iOS")

17. Нажмите кнопку **ОK**, чтобы сохранить измененные свойства проекта.

# <a name="visual-studio-2019"></a>[Visual Studio 2019](#tab/windows)

1. Убедитесь, что среда Visual Studio 2019 [связана с узлом сборки Mac](~/ios/get-started/installation/windows/connecting-to-mac/index.md).
2. В **обозревателе решений** щелкните правой кнопкой мыши **имя проекта** и выберите пункт **Свойства**.
3. На вкладке **Сборка iOS** для параметра **Конфигурация** задайте значение **Выпуск**, а для параметра **Платформа** — **iPhone**.
4. Чтобы выполнить сборку с конкретным пакетом SDK для iOS, выберите его в списке **Версия SDK**. В противном случае оставьте значение **по умолчанию**.
5. Компоновка уменьшает общий размер приложения за счет исключения неиспользуемого кода.
   * В большинстве случаев для **Поведения компоновщика** рекомендуется оставить значение по умолчанию: **Компоновать только пакеты SDK платформы**.
   * Использование параметра **Не компоновать** может привести к тому, что Apple отклонит приложение из-за наличия необщедоступных API iOS в Xamarin.iOS, которые будут связаны с параметром **Компоновать только пакеты SDK платформы**.
   * Параметр **Компоновать все** следует использовать с осторожностью, так как он удалит код из всех сборок проекта, включая сторонние библиотеки. Он может удалить код, который библиотека стороннего производителя может использовать только через отражение, недоступное для обнаружения компоновщику, так как он выполняет статический анализ кода для определения используемого кода библиотеки. Используйте параметр **Компоновать все** с осторожностью, так как может потребоваться вручную сохранить некоторые классы или методы, чтобы избежать сбоев во время выполнения из-за отсутствия кода.
   * Дополнительные сведения см. в руководстве [Компоновка приложений Xamarin.iOS](~/ios/deploy-test/linker.md).
6. Для устройств с iOS 11 необходимо выбрать одну из архитектур, поддерживающих **ARM64**. Дополнительные сведения о сборке для 64-разрядных устройств с iOS см. в разделе по **активации 64-разрядных сборок приложений Xamarin.iOS** в документации [Особенности 32- и 64-разрядных платформ](~/cross-platform/macios/32-and-64/index.md).
7. При необходимости вы можете использовать компилятор **LLVM** для создания более быстрого и компактного кода. Однако в этом случае увеличивается время компиляции.
8. Чтобы еще сильнее уменьшить размер приложения, установите флажок **Оптимизировать изображения PNG**.
9. Включать отладку _не следует_, так как это приведет к неоправданному увеличению размера сборки.
10. Исходя из потребностей вашего приложения, вы также можете настроить тип **сборки мусора** и конфигурацию **интернационализации**.

    После настройки параметров, описанных выше, параметры сборки должны выглядеть примерно следующим образом:

    ![Параметры сборки iOS](publishing-to-the-app-store-images/build-w157.png "Параметры сборки iOS")

    Дополнительные сведения о параметрах сборки см. в руководстве [Механизм сборки iOS](~/ios/deploy-test/ios-build-mechanics.md).

11. Откройте вкладку **Подписывание пакета iOS**. Убедитесь, что для параметра **Конфигурация** выбрано значение **Выпуск**, а для параметра **Платформа** — **iPhone**. Также должен быть выбран параметр **Подготовка вручную**.
12. В качестве значения **Удостоверение подписывания** выберите **Распределение (автоматически)**.
13. В качестве **Профиля подготовки** выберите профиль подготовки App Store, [созданный выше](#create-and-install-an-app-store-provisioning-profile).

    Параметры подписывания для пакета проекта теперь должны выглядеть примерно так:

    ![Параметры подписывания пакета iOS](publishing-to-the-app-store-images/bundleSigning-w157.png "Параметры подписывания пакета iOS")

14. Сохраните и закройте конфигурацию сборки.

# <a name="visual-studio-2017"></a>[Visual Studio 2017](#tab/win-vs2017)

1. Проверьте, что среда Visual Studio 2017 [связана с узлом сборки Mac](~/ios/get-started/installation/windows/connecting-to-mac/index.md).
2. В **обозревателе решений** щелкните правой кнопкой мыши **имя проекта** и выберите пункт **Свойства**.
3. На вкладке **Сборка iOS** для параметра **Конфигурация** задайте значение **Выпуск**, а для параметра **Платформа** — **iPhone**.
4. Чтобы выполнить сборку с конкретным пакетом SDK для iOS, выберите его в списке **Версия SDK**. В противном случае оставьте значение **по умолчанию**.
5. Компоновка уменьшает общий размер приложения за счет исключения неиспользуемого кода.
   * В большинстве случаев для **Поведения компоновщика** рекомендуется оставить значение по умолчанию: **Компоновать только пакеты SDK платформы**.
   * Использование параметра **Не компоновать** может привести к тому, что Apple отклонит приложение из-за наличия необщедоступных API iOS в Xamarin.iOS, которые будут связаны с параметром **Компоновать только пакеты SDK платформы**.
   * Параметр **Компоновать все** следует использовать с осторожностью, так как он удалит код из всех сборок проекта, включая сторонние библиотеки. Он может удалить код, который библиотека стороннего производителя может использовать только через отражение, недоступное для обнаружения компоновщику, так как он выполняет статический анализ кода для определения используемого кода библиотеки. Используйте параметр **Компоновать все** с осторожностью, так как может потребоваться вручную сохранить некоторые классы или методы и т. д., чтобы избежать сбоев во время выполнения из-за отсутствия кода.
   * Дополнительные сведения см. в руководстве [Компоновка приложений Xamarin.iOS](~/ios/deploy-test/linker.md).
6. Для устройств с iOS 11 необходимо выбрать одну из архитектур, поддерживающих **ARM64**. Дополнительные сведения о сборке для 64-разрядных устройств с iOS см. в разделе по **активации 64-разрядных сборок приложений Xamarin.iOS** в документации [Особенности 32- и 64-разрядных платформ](~/cross-platform/macios/32-and-64/index.md).
7. При необходимости вы можете использовать компилятор **LLVM** для создания более быстрого и компактного кода. Однако в этом случае увеличивается время компиляции.
8. Чтобы еще сильнее уменьшить размер приложения, установите флажок **Оптимизировать изображения PNG**.
9. Включать отладку _не следует_, так как это приведет к неоправданному увеличению размера сборки.
10. Исходя из потребностей приложения, вы также можете настроить используемый тип **сборки мусора** и **интернационализацию**.

    После настройки параметров, описанных выше, параметры сборки должны выглядеть примерно следующим образом:

    ![Параметры сборки iOS](publishing-to-the-app-store-images/build-w157.png "Параметры сборки iOS")

    Дополнительные сведения о параметрах сборки см. в руководстве [Механизм сборки iOS](~/ios/deploy-test/ios-build-mechanics.md).

11. Откройте вкладку **Подписывание пакета iOS**. Убедитесь, что для параметра **Конфигурация** выбрано значение **Выпуск**, а для параметра **Платформа** — **iPhone**. Также должен быть выбран параметр **Подготовка вручную**.
12. В качестве значения **Удостоверение подписывания** выберите **Распределение (автоматически)**.
13. В качестве **Профиля подготовки** выберите профиль подготовки App Store, [созданный выше](#create-and-install-an-app-store-provisioning-profile).

    Параметры подписывания для пакета проекта теперь должны выглядеть примерно так:

    ![Снимок экрана: параметры подписывания пакета iOS.](publishing-to-the-app-store-images/bundleSigning-w157.png "Параметры подписывания пакета iOS")

14. Откройте вкладку **Параметры IPA iOS**.
15. Для элемента **Конфигурация** выберите значение **Выпуск**, а для элемента **Платформа** — **iPhone**.
16. Поставьте флажок **Создать архив пакета iTunes (IPA)**. В этом случае каждая сборка **Выпуск** (так как это выбранная конфигурация) будет создавать файл с расширением .ipa. Этот файл можно отправить в Apple для публикации в App Store.

    > [!NOTE]
    > **Метаданные iTunes** и **iTunesArtwork** являются необязательными для публикации в App Store. Дополнительные сведения см. в статьях [Файл iTunesMetadata.plist в приложениях Xamarin.iOS](~/ios/deploy-test/app-distribution/itunesmetadata.md) и [Иллюстрации iTunes](~/ios/app-fundamentals/images-icons/app-icons.md#itunes-artwork).

17. Чтобы указать имя IPA-файла, которое отличается от имени проекта Xamarin.iOS, введите его в поле **Имя пакета**.

    ![Снимок экрана: вкладка "Параметры IPA iOS".](publishing-to-the-app-store-images/ipaOptions-w157.png "Параметры подписывания пакета iOS")

18. Сохраните и закройте конфигурацию сборки.

-----

## <a name="configure-your-app-in-itunes-connect"></a>Настройка приложения в iTunes Connect

[iTunes Connect](https://itunesconnect.apple.com) — это набор веб-инструментов для управления iOS-приложениями в App Store. Необходимо должным образом настроить приложение Xamarin.iOS в iTunes Connect, прежде чем отправлять его на проверку в Apple и публиковать в App Store.

Чтобы узнать, как это сделать, см. руководство [Настройка приложения в iTunes Connect](~/ios/deploy-test/app-distribution/app-store-distribution/itunesconnect.md).

## <a name="build-and-submit-your-app"></a>Сборка и отправка приложения

Когда вы настроите должным образом параметры сборки и iTunes Connect будет ожидать отправки, вы можете выполнить сборку приложения и отправить его в Apple.

# <a name="visual-studio-for-mac"></a>[Visual Studio для Mac](#tab/macos)

1. В Visual Studio для Mac выберите конфигурацию сборки **Выпуск** и устройство (не симулятор), для которого выполняется сборка.

    ![Выбор платформы и конфигурации сборки](publishing-to-the-app-store-images/chooseConfig-m157.png "Выбор платформы и конфигурации сборки")

2. В меню **Сборка** выберите пункт **Архивировать для публикации**.
3. После создания архива появится представление **Архивы**. Нажмите кнопку **Подписать и распространить**, чтобы открыть мастер публикации.

    ![Снимок экрана: расположение кнопки Подписать и распространить в представлении Архивы.](publishing-to-the-app-store-images/archives-mac.png "Снимок экрана: расположение кнопки Подписать и распространить в представлении Архивы.")

    > [!NOTE]
    > По умолчанию в представлении **Архивы** показаны только архивы для открытого решения. Чтобы просмотреть все решения с архивами, установите флажок **Показать все архивы**. Рекомендуем сохранять старые архивы, чтобы при необходимости использовать содержащуюся в них отладочную информацию для формирования отчетов о сбоях с символьным выражением.

4. Выберите **App Store** в качестве канала распространения. Нажмите кнопку **Далее**.

5. Выберите **Отправить** в качестве места назначения. Нажмите кнопку **Далее**.

6. В окне **Профиль подготовки** выберите удостоверение для подписывания, приложение и профиль подготовки. Нажмите кнопку **Далее**.

    ![Снимок экрана: страница мастера профилей подготовки с выбором допустимого удостоверения для подписывания, приложения и профиля подготовки.](publishing-to-the-app-store-images/provProfileSelect-mac.png "Снимок экрана: страница мастера профилей подготовки с выбранным допустимым удостоверением для подписывания, приложением и профилем подготовки.")

7. В окне **Сведения об App Store Connect** в меню выберите имя пользователя Apple ID и введите [пароль для приложения](https://support.apple.com/ht204397). Нажмите кнопку **Далее**.

    ![Снимок экрана: страница мастера сведений об App Store Connect с выбранным именем пользователя Apple ID.](publishing-to-the-app-store-images/connectInfo-mac.png "Снимок экрана: страница мастера сведений об App Store Connect с выбранным именем пользователя Apple ID.")

8. Проверьте сведения о пакете, а затем нажмите кнопку **Опубликовать**. После выбора расположения для сохранения IPA-файла мастер отправит приложение в App Store Connect.

    > [!NOTE]
    > Компания Apple может отклонить приложения с файлом **iTunesMetadata.plist**, включенным в IPA-файл, что приводит к ошибке следующего вида:
    >
    > `ERROR: ERROR ITMS-90047: "Disallowed paths ( "iTunesMetadata.plist" ) found at: Payload/iPhoneApp1.app"`
    >
    > Сведения об устранении этой ошибки см. в [этой записи на форумах Xamarin](https://forums.xamarin.com/discussion/40388/disallowed-paths-itunesmetadata-plist-found-at-when-submitting-to-app-store/p1).

# <a name="visual-studio-2019"></a>[Visual Studio 2019](#tab/windows)

> [!NOTE]
> Публикация в App Store поддерживается в Visual Studio 2019 версии 16.3 и более поздних.

1. Убедитесь, что среда Visual Studio 2019 [связана с узлом сборки Mac](~/ios/get-started/installation/windows/connecting-to-mac/index.md).
2. В раскрывающемся списке **Конфигурации решения** выберите **Выпуск**, а в раскрывающемся списке **Платформы решения** выберите **iPhone**.

    ![Снимок экрана: панель инструментов Visual Studio, в которой для параметра конфигурации решения задано значение Выпуск, для платформы решения задано значение iPhone, а для параметра Целевой объект задано значение Устройство.](publishing-to-the-app-store-images/chooseConfig-w157.png "Снимок экрана: панель инструментов Visual Studio, в которой для параметра конфигурации решения задано значение Выпуск, для платформы решения задано значение iPhone, а для параметра Целевой объект задано значение Устройство.")

3. В меню **Сборка** выберите **Архивировать...** . Откроется **Диспетчер архивов** и начнется создание архива.

4. После создания архива щелкните **Распределить...**, чтобы открыть мастер публикации.

    ![Снимок экрана: расположение кнопки Распределить в представлении диспетчера архивов.](publishing-to-the-app-store-images/archives-win.png "Снимок экрана: расположение кнопки Распределить в представлении диспетчера архивов.")

5. Выберите **App Store** в качестве канала распространения.

6. Выберите удостоверение подписывания и профиль подготовки. Щелкните **Загрузить в магазин**.

    ![Снимок экрана: мастер публикации с выбором допустимого удостоверения для подписывания и профиля подготовки.](publishing-to-the-app-store-images/provProfileSelect-win.png "Снимок экрана: мастер публикации с выбором допустимого удостоверения для подписывания и профиля подготовки.")

7. Введите идентификатор Apple ID и [пароль для приложения](https://support.apple.com/ht204397). Щелкните **OK**, чтобы начать передачу приложения в App Store Connect.

    ![Снимок экрана: всплывающее окно для ввода идентификатора Apple ID и пароля приложения.](publishing-to-the-app-store-images/connectInfo-win.png "Снимок экрана: всплывающее окно для ввода идентификатора Apple ID и пароля приложения.")

# <a name="visual-studio-2017"></a>[Visual Studio 2017](#tab/win-vs2017)

> [!NOTE]
> Visual Studio 2017 не поддерживает полный рабочий процесс публикации, доступный в Visual Studio для Mac и Visual Studio 2019.
>
> Приведенные ниже действия относятся к Xcode 10.
>
> Вы по-прежнему можете выполнить приведенные ниже действия, чтобы создать файл IPA, но для развертывания в App Store с помощью Xcode 11 (требуется для поддержки iOS 13) следует использовать [Visual Studio для Mac](?tabs=macos#build-and-submit-your-app).

1. Проверьте, что среда Visual Studio 2017 [связана с узлом сборки Mac](~/ios/get-started/installation/windows/connecting-to-mac/index.md).
2. В Visual Studio 2017 в раскрывающемся списке **Конфигурации решения** выберите **Выпуск**, а в раскрывающемся списке **Платформы решения** выберите **iPhone**.

    ![Выбор платформы и конфигурации сборки](publishing-to-the-app-store-images/chooseConfig-w157.png "Выбор платформы и конфигурации сборки")

3. Выполните построение проекта. Будет создан IPA-файл.

    > [!NOTE]
    > В разделе [Обновление конфигурации сборки "Выпуск"](#update-the-release-build-configuration) этого документа параметры сборки приложения настроены для создания IPA-файла для каждой сборки **Выпуск**.

4. Чтобы найти IPA-файл на компьютере Windows, в Visual Studio 2019 или Visual Studio 2017 в **обозревателе решений** щелкните правой кнопкой мыши имя проекта Xamarin.iOS и выберите пункт **Open Folder in File Explorer** (Открыть папку в проводнике). Затем в открывшемся **проводнике** Windows перейдите в подкаталог **iPhone/bin/Release**. Если вы не [настроили расположение выходного IPA-файла](#customize-the-ipa-location), оно должно находиться в этом каталоге.
5. Чтобы просмотреть IPA-файл на узле сборки Mac, в Visual Studio 2019 или Visual Studio 2017 в **обозревателе решений** (в Windows) щелкните правой кнопкой мыши имя проекта Xamarin.iOS и выберите пункт **Show IPA File on Build Server** (Показать IPA-файл на сервере сборки). На узле сборки Mac откроется окно **системы поиска** с выбранным IPA-файлом.

    > [!TIP]
    >
    > Следующие шаги допустимы только в том случае, если вы используете Xcode 10 и выполняете сборку для iOS 12 и более ранних версий.
    >
    > Для развертывания в App Store с помощью Xcode 11 (для iOS 13), необходимо [использовать Visual Studio для Mac](?tabs=macos#build-and-submit-your-app), чтобы создать и передать приложение. **Загрузчик приложений** будет недоступен для Xcode 11.

6. На узле сборки Mac откройте **загрузчик приложений**. В Xcode выберите **Xcode > Open Developer Tool > Application Launcher** (Xcode > Открыть средство разработчика > Загрузчик приложений).

    > [!NOTE]
    > Дополнительные сведения о средстве см. в [документации Apple по загрузчику приложений](https://help.apple.com/itc/apploader/#/apdS673accdb).

7. Выполните вход в загрузчик приложений (обратите внимание, что для Apple ID необходимо [создать соответствующий приложению пароль](https://support.apple.com/ht204397)).
8. Щелкните **Deliver Your App** (Доставить приложение) и нажмите кнопку **Choose** (Выбрать):

    ![Нажатие кнопки доставки приложения](publishing-to-the-app-store-images/publishvs01.png "Нажатие кнопки доставки приложения")

9. Выберите ранее созданный IPA-файл и нажмите кнопку **OK**.
10. Загрузчик приложения выполнит проверку файла:

    ![Экран проверки](publishing-to-the-app-store-images/publishvs02.png "Экран проверки")

11. Нажмите кнопку **Next** (Далее). Приложение будет проверено на соответствие требованиям App Store:

    ![Проверка на соответствие требованиям App Store](publishing-to-the-app-store-images/publishvs03.png "Проверка на соответствие требованиям App Store")

12. Нажмите кнопку **Send** (Отправить), чтобы отправить приложение на проверку в компанию Apple.
13. После успешной загрузки появится соответствующее сообщение загрузчика приложений.

    > [!NOTE]
    > Компания Apple может отклонить приложения с файлом **iTunesMetadata.plist**, включенным в IPA-файл, что приводит к ошибке следующего вида:
    >
    > `ERROR: ERROR ITMS-90047: "Disallowed paths ( "iTunesMetadata.plist" ) found at: Payload/iPhoneApp1.app"`
    >
    > Сведения об устранении этой ошибки см. в [этой записи на форумах Xamarin](https://forums.xamarin.com/discussion/40388/disallowed-paths-itunesmetadata-plist-found-at-when-submitting-to-app-store/p1).

-----

## <a name="itunes-connect-status"></a>Состояние iTunes Connect

Чтобы просмотреть состояние отправки приложения, войдите в iTunes Connect и выберите приложение. Должно отображаться начальное состояние **Waiting For Review** (Ожидание проверки), хотя при обработке может временно выводиться **Upload Received** (Получена отправка).

![Ожидание проверки](publishing-to-the-app-store-images/image21.png "Ожидание проверки")

## <a name="tips-and-tricks"></a>Советы и рекомендации

### <a name="customize-the-ipa-location"></a>Настройка расположения IPA-файла

Свойство `IpaPackageDir` в **MSBuild** позволяет настраивать выходную папку IPA-файла. Если в параметре `IpaPackageDir` задано настраиваемое расположение, IPA-файл будет помещен в указанную папку, а не в установленный по умолчанию подкаталог с меткой времени. Это может быть полезно при создании автоматизированных сборок, для работы которых требуется конкретный путь к каталогу (например, это могут быть сборки непрерывной интеграции).

Использовать новое свойство можно несколькими способами. Например, чтобы выводить IPA-файл в старый каталог по умолчанию (как в Xamarin.iOS 9.6 и более ранних версиях), задайте для свойства `IpaPackageDir` значение `$(OutputPath)` одним из следующих способов. Оба подхода совместимы со всеми сборками Unified API Xamarin.iOS, включая сборки интегрированной среды разработки и командной строки, которые используют **msbuild** или **mdtool**:

- Первый способ подразумевает установку свойства `IpaPackageDir` в элементе `<PropertyGroup>` в файле **MSBuild**. Например, можно добавить следующий элемент `<PropertyGroup>` в конец CSPROJ-файла проекта приложения iOS (непосредственно перед закрывающим тегом `</Project>`):

    ```xml
    <PropertyGroup>
      <IpaPackageDir>$(OutputPath)</IpaPackageDir>
    </PropertyGroup>
    ```

- Более эффективный подход заключается в добавлении элемента `<IpaPackageDir>` в конец существующего элемента `<PropertyGroup>`, который соответствует конфигурации, используемой при сборке IPA-файла. Это способ является рекомендуемым, поскольку он позволяет обеспечить дальнейшую совместимость с запланированными настройками на странице параметров IPA-файла для iOS в свойствах проекта. Если вы в данный момент используете конфигурацию `Release|iPhone` для сборки IPA-файла, полностью обновленная группа свойств может иметь следующий вид:

    ```xml
    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|iPhone'">
       <Optimize>true</Optimize>
       <OutputPath>bin\iPhone\Release</OutputPath>
       <ErrorReport>prompt</ErrorReport>
       <WarningLevel>4</WarningLevel>
       <ConsolePause>false</ConsolePause>
       <CodesignKey>iPhone Developer</CodesignKey>
       <MtouchUseSGen>true</MtouchUseSGen>
       <MtouchUseRefCounting>true</MtouchUseRefCounting>
       <MtouchFloat32>true</MtouchFloat32>
       <CodesignEntitlements>Entitlements.plist</CodesignEntitlements>
       <MtouchLink>SdkOnly</MtouchLink>
       <MtouchArch>ARMv7, ARM64</MtouchArch>
       <MtouchHttpClientHandler>HttpClientHandler</MtouchHttpClientHandler>
       <MtouchTlsProvider>Default</MtouchTlsProvider>
       <BuildIpa>true</BuildIpa>
       <IpaPackageDir>$(OutputPath)</IpaPackageDir>
    </PropertyGroup>
    ```

Альтернативный способ для сборок командной строки **msbuild** заключается в добавлении аргумента командной строки `/p:` для установки свойства `IpaPackageDir`. В этом случае обратите внимание, что **msbuild** не развертывает выражения `$()`, передаваемые в командную строку, поэтому использовать синтаксис `$(OutputPath)` невозможно. Вместо этого необходимо предоставить полный путь.

```bash
msbuild /p:Configuration="Release" /p:Platform="iPhone" /p:ServerAddress="192.168.1.3" /p:ServerUser="macuser" /p:IpaPackageDir="%USERPROFILE%\Builds" /t:Build SingleViewIphone1.sln
```

В Mac он будет иметь следующий вид:

```bash
msbuild /p:Configuration="Release" /p:Platform="iPhone" /p:IpaPackageDir="$HOME/Builds" /t:Build SingleViewIphone1.sln
```

После того как была создана и архивирована сборка для распространения, все готово для отправки приложения в iTunes Connect.

## <a name="summary"></a>Сводка

В этой статье описывались процедуры настройки, создания и отправки приложения iOS для публикации в App Store.

## <a name="related-links"></a>Связанные ссылки

- [Портал для разработчиков Apple (Apple)](https://developer.apple.com/account/)
- [iTunes Connect (Apple)](https://itunesconnect.apple.com)
- [Правила проверки приложений в App Store (Apple)](https://developer.apple.com/appstore/resources/approval/guidelines.html)
- [Распространенные причины отклонения приложений (Apple)](https://developer.apple.com/app-store/review/rejections/)
- [Работа с возможностями в Xamarin.iOS](~/ios/deploy-test/provisioning/capabilities/index.md)
- [Работа с назначениями в Xamarin.iOS](~/ios/deploy-test/provisioning/entitlements.md)
- [Настройка приложения в iTunes Connect](~/ios/deploy-test/app-distribution/app-store-distribution/itunesconnect.md)
- [Значки приложений в Xamarin.iOS](~/ios/app-fundamentals/images-icons/app-icons.md)
- [Экраны запуска для приложений Xamarin.iOS](~/ios/app-fundamentals/images-icons/launch-screens.md)
